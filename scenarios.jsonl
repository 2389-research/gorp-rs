{"name": "acp-new-session", "given": "fresh channel with no session", "when": "first message sent", "then": "ACP session created and logged to acp-messages.jsonl", "validates": "ACP Initialize + NewSession flow"}
{"name": "acp-prompt-response", "given": "existing ACP session", "when": "prompt sent via webhook", "then": "response received in Matrix", "validates": "ACP PromptRequest flow"}
{"name": "acp-tool-events", "given": "prompt requiring tool use", "when": "agent uses Read tool", "then": "ToolUse event emitted and logged", "validates": "SessionUpdate streaming with ToolCall"}
{"name": "acp-session-resume", "given": "existing session ID in DB", "when": "gorp-acp restarts and prompt sent", "then": "LoadSession attempted, fallback to new session if fails (see docs/SESSION-RESUME-LIMITATION.md)", "validates": "graceful degradation when ACP session not found", "status": "known-limitation"}
{"name": "dedup-single-message", "given": "A single Matrix message event arrives via sync", "when": "The event passes through the EventDeduplicator", "then": "The event is processed exactly once", "validates": "Basic message flow works correctly", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-duplicate-rejected", "given": "The same event_id arrives 10 times (production bug pattern)", "when": "Each event passes through the EventDeduplicator", "then": "Only the first event is processed, 9 are skipped", "validates": "Deduplication prevents duplicate processing", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-unique-all-processed", "given": "5 events with different event_ids arrive", "when": "Each event passes through the EventDeduplicator", "then": "All 5 events are processed", "validates": "Deduplication doesn't falsely reject unique events", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-burst-multiple-rooms", "given": "3 rooms each send 10 copies of their event", "when": "All 30 events pass through the EventDeduplicator", "then": "Only 3 events are processed (one per room)", "validates": "Multi-room duplicate burst is handled correctly", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-concurrent-delivery", "given": "5 concurrent tasks send the same event_id", "when": "Events race through the channel and dedup filter", "then": "Only 1 event is processed regardless of delivery order", "validates": "Concurrency safety of deduplication", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-cache-overflow", "given": "Cache is full (max_size reached)", "when": "A new event triggers cache clear", "then": "Old events can be reprocessed (bounded memory trade-off)", "validates": "Memory bounds are respected", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-matrix-event-ids", "given": "Events with base64-encoded IDs and server suffixes", "when": "Events pass through the EventDeduplicator", "then": "Duplicates are correctly identified by full event_id string", "validates": "Production event ID format compatibility", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-high-throughput", "given": "1000 unique events arrive", "when": "All events pass through the EventDeduplicator", "then": "All 1000 events are processed", "validates": "Performance under load", "test_file": "tests/dedup_integration_tests.rs"}
{"name": "dedup-interleaved-pattern", "given": "Events arrive in pattern: unique, dup, unique, dup, dup, unique", "when": "Each event passes through the EventDeduplicator", "then": "3 unique events processed, 3 duplicates skipped", "validates": "Correct behavior with interleaved event patterns", "test_file": "tests/dedup_integration_tests.rs"}

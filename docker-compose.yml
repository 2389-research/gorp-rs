# ABOUTME: Docker Compose configuration for gorp Matrix-Claude bridge
# ABOUTME: Uses XDG-compliant paths with volume mounts for config and data persistence
version: '3.8'

services:
  gorp:
    build: .
    image: gorp:latest
    container_name: gorp
    restart: unless-stopped

    # Environment variables (override config.toml values)
    # Use env_file OR environment, not both for the same vars
    env_file:
      - .env

    # Claude Code auth - set this OR shell in and run `claude` to login
    # environment:
    #   - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

    # Persistent volumes using XDG directory structure
    volumes:
      # Config directory - put your config.toml here
      - ./config:/home/gorp/.config/gorp

      # Claude Code config - persists auth across restarts
      - ./claude-config:/home/gorp/.config/claude

      # Data directory (crypto store, logs, scheduled prompts db)
      - ./data:/home/gorp/.local/share/gorp

      # Workspace directory for Claude sessions
      - ./workspace:/home/gorp/workspace

      # MCP tool data directories
      - ./mcp-data/chronicle:/home/gorp/.local/share/chronicle
      - ./mcp-data/memory:/home/gorp/.local/share/memory
      - ./mcp-data/toki:/home/gorp/.local/share/toki
      - ./mcp-data/pagen:/home/gorp/.local/share/pagen

    # Webhook port
    ports:
      - "13000:13000"

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

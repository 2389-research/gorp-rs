# ABOUTME: Docker Compose configuration for gorp Matrix-Claude bridge
# ABOUTME: Uses XDG-compliant paths with volume mounts for config and data persistence
version: '3.8'

services:
  gorp:
    build: .
    image: gorp:latest
    container_name: gorp
    restart: unless-stopped

    # Environment variables (override config.toml values)
    # Use env_file OR environment, not both for the same vars
    env_file:
      - .env

    # Claude Code auth - set this OR shell in and run `claude` to login
    # environment:
    #   - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

    # Persistent volumes - all data under ./app-data/
    volumes:
      # Config directory - put your config.toml here
      - ./app-data/config:/home/gorp/.config/gorp

      # Claude Code config - persists auth across restarts
      - ./app-data/claude-config:/home/gorp/.config/claude

      # Claude CLI settings (API key, preferences)
      - ./app-data/claude-settings:/home/gorp/.claude

      # Data directory (crypto store, logs, scheduled prompts db)
      - ./app-data/data:/home/gorp/.local/share/gorp

      # Workspace directory for Claude sessions
      - ./app-data/workspace:/home/gorp/workspace

      # MCP tool data directories
      - ./app-data/mcp-data/chronicle:/home/gorp/.local/share/chronicle
      - ./app-data/mcp-data/memory:/home/gorp/.local/share/memory
      - ./app-data/mcp-data/toki:/home/gorp/.local/share/toki
      - ./app-data/mcp-data/pagen:/home/gorp/.local/share/pagen
      - ./app-data/mcp-data/gsuite-mcp:/home/gorp/.config/gsuite-mcp
      - ./app-data/mcp-data/digest:/home/gorp/.local/share/digest

    # Webhook port
    ports:
      - "13000:13000"

    # Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
